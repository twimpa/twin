<!DOCTYPE html>
<html>
  <head>
    <title>Rec2D</title>
    <meta charset="utf8">
    <script type="text/javascript" src="src/common_canvas.js"></script>
    <script type="text/javascript" src="src/TWImage.js"></script>
    <script type="text/javascript" src="src/TWStack.js"></script>
    <script type="text/javascript" src="src/TWStackSplitter.js"></script>
    <script type="text/javascript" src="src/TWGraph.js"></script>
    <script type="text/javascript" src="src/nodes.js"></script>
    <script type="text/javascript" src="src/graph.js"></script>
    <script>
    const main = () => {
      
      // Case 1: function map(..)
      console.info('Case #1');
      const t00 = performance.now();

      let input = document.getElementById('input');
      let w = input.naturalWidth;
      let h = input.naturalHeight;
      let sinogram = new TWImage(input,0,0,w,h);
      
      let rec2d = sinogram
        .toStack(h,1)
        .map( (slice,i) => slice.resize(w,w).rotate(-i) )
        .zproject(TWIN.AVERAGE)
        .normalize({cx: 0.5,cy: 0.5,radius:0.4})
        .show();
      
      const t01 = performance.now();
      console.log(`Performance: ${(t01 - t00)} milliseconds.`);
      
      // Case 2: No function map(..) - 
      console.info('Case #2');
      const t10 = performance.now();
      let proto = sinogram
        .toStack(h,1)
        .forEach() // Split the stack into slices
          .resize(w,w)
          .rotate(range(0,-180,-1) )
        .saveInStack()
        .zproject()
        .normalize({cx: 0.5,cy: 0.5,radius:0.4})
        .show();
        
      const t11 = performance.now();
      console.log(`Performance: ${(t11 - t10)} milliseconds.`);
      
      // Case 3: Use of nodes graph
      console.info('Case #3');
        
      // Case 4: Graph defined as JSON
      // `nodes` are defined in `graph.js`
      let graph = new TWGraph(nodes);
      graph.run(
        [
          load,
          info,
          start,
          toStack(180,1,0),
          forEach,
          resize(256,256),
          nrange(0,-180,-1),
          rotate,
          saveInStack,
          zproject,
          normalize({cx: 0.5,cy: 0.5,radius:0.4}),
          end,
          show
        ],{path:'./data/Sinogram_ramp_filter.png', count: 0});
    }

    </script>
  </head>
  <body onload="main()">
    <img id="input" src="./data/Sinogram_ramp_filter.png"></img >
    <!--img id="input" src="sinogram.png"></img-->
  </body>
</html>
