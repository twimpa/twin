<!DOCTYPE html>
<html>
<head>
<meta charset="utf8">
<title>TWIN Chessboard</title>
<link href="https://fonts.googleapis.com/css?family=Lato:700" rel="stylesheet"> 
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.2/css/all.css" integrity="sha384-oS3vJWv+0UjzBfQzYUhtDYW+Pj2yciDJxpsK1OYPAYjqT085Qq/1cq5FLXAZQ7Ay" crossorigin="anonymous">
<link rel="stylesheet" href="../css/twin.css">
<script type="text/javascript" src="../javascripts/twin.js"></script>

</head>
<body>
<main>
</main>

<script type="text/javascript">
  'use strict';



  ////// MAIN //////

  let main = document.querySelector('main');

  fetch('../templates/nodes.json', {
    method: 'GET',
    headers: new Headers({'Content-Type': 'application/json'}),
    mode: 'cors',
    cache: 'default'

  })
  .then ( response => response.json() )
  .catch ( error => {
    alert(`Something went wrong - ${error}`)
  })
  .then ( nodeTemplates => {
    console.log(nodeTemplates);
    // Create Graph
    TWIP.nodeTemplates = nodeTemplates;

    // Create Edges
    let svg = document.createElementNS(xmlns,'svg');
    svg.setAttribute('width','100%');
    svg.setAttribute('height','100%');

    main.prepend(svg);
    let boardgame = document.createElement('div');
    boardgame.id = 'board';
    boardgame.className = 'board';
    main.appendChild(boardgame);

    // Load Test Graph
    let test = {
      nodes: [
        {
          id: 0,
          template:1,
          pos: [0,0],
          metadata: {
            comment: "New...",
            type: "8-bit",
            width: 256,
            height: 256,
            fill: 0,
            nslices: 1
          }
        },
        {
          id: 3,
          template:74,
          pos: [0,0],
          metadata: {
            comment: "Fold"
          }
        },
        {
          id: 5,
          template:27,
          pos: [0,0],
          metadata: {
            comment: "Fill"
          }
        },
        {
          id: 22,
          template:11,
          pos: [0,0],
          metadata: {
            comment: "Viewer2D"
          }
        },
        {
          id: 30,
          template:23,
          pos: [0,0],
          metadata: {
            comment: "toStack",
            nrows: 8,
            ncols: 8,
            border: 0
          }
        },
        {
          id: 32,
          template:73,
          pos: [0,0],
          metadata: {
            comment: "Unfold",
            axis: 'Z'
          }
        },
        {
          id: 34,
          template:72,
          pos: [0,0],
          metadata: {
            comment: "Select",
            tagged: true,
            select: "(x+y) % 2 === 0"
          }
        },
        {
          id: 35,
          template:22,
          pos: [0,0],
          metadata: {
            comment: "Montage",
            nRows: 8,
            nCols: 8,
            scale: 1.0,
            border: 0,
            labels: false
          }
        },
        {
          id: 40,
          template:81,
          pos: [0,0],
          metadata: {
            comment: "Set...",
            code0: "x = index % 8",
            code1: "y = floor(index / 8)"
          }
        },
        {
          id: 50,
          template:50,
          pos: [0,0],
          metadata: {
            comment: "Information"
          }
        }
      ],
      edges : [
        {
          eid: 1,
          source: 0,out: 0,
          target: 30, in: 0,
        },
        {
          eid: 2,
          source: 30,out: 0,
          target: 32, in: 0,
        },
        {
          eid: 4,
          source: 34,out: 0,
          target: 5, in: 1,
        },
        {
          eid: 5,
          source: 5,out: 0,
          target: 3, in: 0,
        },
        {
          eid: 6,
          source: 3,out: 0,
          target: 35, in: 0,
        },
        {
          eid: 8,
          source: 32,out: 0,
          target: 40, in: 0,
        },
        {
          eid: 9,
          source: 32,out: 0,
          target: 50, in: 0,
        },
        {
          eid: 10,
          source: 32,out: 0,
          target: 34, in: 1,
        },
        {
          eid: 12,
          source: 35,out: 0,
          target: 22, in: 0,
        },
        {
          eid: 14,
          source: 40,out: 0,
          target: 34, in: 0,
        }
      ]
    };

/*
        {
          eid: 3,
          source: 41,out: 0,
          target: 50, in: 1,
        },
        {
          eid: 7,
          source: 34,out: 0,
          target: 5, in: 0,
        },
        {
          eid: 11,
          source: 40,out: 0,
          target: 50, in: 0,
        },
        {
          eid: 13,
          source: 50,out: 0,
          target: 34, in: 0,
        },
*/


    TWIP.graph.setTemplates(nodeTemplates);
    TWIP.graph.setRootNode(boardgame);
    TWIP.graph.setGraphicsContext(svg);
    TWIP.graph.build(test);
    TWIP.graph.show();

    TWIP.init();
  }); 

</script>
</body>
</html>
