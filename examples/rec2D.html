<!DOCTYPE html>
<html>
<head>
<meta charset="utf8">
<title>TWIN - Rec2D</title>
<link href="https://fonts.googleapis.com/css?family=Lato:700" rel="stylesheet"> 
<link rel="stylesheet" type="text/css" href="https://netdna.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.css" rel="stylesheet">
<link rel="stylesheet" href="../css/twin.css">
<script type="text/javascript" src="../dist/twin.js"></script>

</head>
<body>
<main>
</main>

<script type="text/javascript">
  'use strict';

  ////// MAIN //////

  let main = document.querySelector('main');

  TWIN.init();
  
  
  fetch('../templates/nodes.json', {
    method: 'GET',
    headers: new Headers({'Content-Type': 'application/json'}),
    mode: 'cors',
    cache: 'default'

  })
  .then ( response => response.json() )
  .catch ( error => {
    alert(`Something went wrong - ${error}`)
  })
  .then ( nodeTemplates => {
  
    // Create Board + Graph
    let board = new Board(main, nodeTemplates);


    // Load Rec2D Graph
    let test = {
      nodes: [
        {
          id: 0,
          template:2,
          metadata: {
            comment: "Open...",
            pos: [507,224]
          }
        },
        {
          id: 3,
          template:23,
          metadata: {
            comment: "toStack",
            pos: [224,266],
            nrows: 180,
            ncols:1,
            border: 0
          }
        },
        {
          id: 5,
          template:74,
          metadata: {
            comment: "Aggregate/Collect",
            pos: [956,260],
          }
        },
        {
          id: 6,
          template:71,
          metadata: {
            comment: "Range",
            pos: [584,154],
            start:0,
            stop:-180,
            step:-1
          }
        },
        {
          id: 14,
          template:36,
          metadata: {
            comment: "Resize",
            pos: [560,300],
            rsz_width: 256,
            rsz_height: 256
          }
        },
        {
          id: 17,
          template:73,
          metadata: {
            comment: "Fold",
            pos: [387,262],
            axis: "Z"
          }
        },
        {
          id: 20,
          template:35,
          metadata: {
            comment: "Rotate",
            pos: [800,290],
            angle: "auto"
          }
        },
        {
          id: 21,
          template:78,
          metadata: {
            comment: "Project",
            pos: [1100,227],
            axis: "Z",
            op:"Average"
          }
        },
        {
          id: 22,
          template:11,
          metadata: {
            comment: "Viewer2D",
            pos: [1270,261],
          }
        }
      ],
      edges : [
        {
          eid: 1,
          sockets: ['raster__FROM__0','raster2d__TO__3'],
        },
        {
          eid: 2,
          sockets: ['data__FROM__17','raster2d__TO__14'],
        },
        {
          eid: 3,
          sockets: ['array__FROM__6','angle__TO__20'],
          source: 6,out: 0,
          target: 20, in: 0,
        },
        {
          eid: 4,
          sockets: ['rot_raster2d__FROM__20','data__TO__5'],
          source: 20,out: 0,
          target: 5, in: 0,
        },
        {
          eid: 5,
          sockets: ['rsz_raster2d__FROM__14','raster2d__TO__20'],
          source: 14,out: 0,
          target: 20, in: 1,
        },
        {
          eid: 6,
          sockets: ['array__FROM__5','data__TO__21'],
          source: 5,out: 0,
          target: 21, in: 0,
        },
        {
          eid: 7,
          sockets: ['proj_data__FROM__21','raster2d__TO__22'],
          source: 21,out: 0,
          target: 22, in: 0,
        },
        {
          eid: 8,
          sockets: ['stack__FROM__3','array__TO__17'],
          source: 3,out: 0,
          target: 17, in: 1,
        }
      ]
    };

    board.load(test);
    board.run();
  }); 

</script>
</body>
</html>
